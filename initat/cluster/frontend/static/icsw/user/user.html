<script type="text/ng-template" id="icsw/main/user/account.html">
    <div ng-controller="icswUserAccountCtrl">
        <icsw-user-account-detail></icsw-user-account-detail>
        <hr/>
        <h2>Permissions</h2>
        <icsw-user-group-permissions></icsw-user-group-permissions>
        <h2>Quota info</h2>
        <icsw-user-quota-settings
            icsw-object="struct.user"
            icsw-object-type="'user'"
            icsw-user-group-settings-tree="struct.settings_tree">
        </icsw-user-quota-settings>
    </div>
</script>

<script type="text/ng-template" id="icsw/main/user/tree.html">
    <div ng-controller="icswUserGroupTreeCtrl">
        <div ng-if="struct.error_string">
            <uib-alert type="warning">{{ struct.error_string }}</uib-alert>
        </div>
        <uib-tabset ng-if="struct.tree_loaded">
            <uib-tab>
                <uib-tab-heading>
                    User ({{ struct.user_group_tree.user_list.length }}) / Group ({{ struct.user_group_tree.group_list.length }}) Tree
                </uib-tab-heading>
                <div class="form-inline">
                    <input type="text" class="form-control" ng-model="struct.filterstr" placeholder="filter ..." ng-change="update_filter()"/>
                    <icsw-tools-button type="create" value="create group" ng-click="create_group()"></icsw-tools-button>
                    &nbsp;
                    <icsw-tools-button type="create" value="create user" ng-click="create_user()"></icsw-tools-button>
                    &nbsp;
                    <icsw-tools-button type="submit" value="sync users" ng-click="sync_users()"></icsw-tools-button>
                </div>
                <icsw-react-tree icsw-tree-config="struct.display_tree"></icsw-react-tree>
            </uib-tab>
            <uib-tab ng-repeat="edit_group in struct.edit_groups">
                <uib-tab-heading>
                    Group {{ edit_group.name }} ({{ edit_group.gid }})
                    <span class="label label-danger" ng-show="changed(edit_group)">Changed</span>
                    <icsw-tools-button size="xs" type="close" value="" ng-click="close_group(edit_group)"></icsw-tools-button>
                </uib-tab-heading>
                <icsw-group-edit
                    icsw-group="edit_group"
                    icsw-permission-tree="struct.perm_tree"
                    icsw-user-group-tree="struct.user_group_tree"
                    icsw-user-group-settings-tree="struct.ugs_tree"
                    icsw-device-tree="struct.device_tree"
                ></icsw-group-edit>
            </uib-tab>
            <uib-tab ng-repeat="edit_user in struct.edit_users">
                <uib-tab-heading>
                    User {{ edit_user.login }} ({{ edit_user.uid }})
                    <span class="label label-danger" ng-show="changed(edit_user)">Changed</span>
                    <icsw-tools-button size="xs" type="close" value="" ng-click="close_user(edit_user)"></icsw-tools-button>
                </uib-tab-heading>
                <icsw-user-edit
                    icsw-user="edit_user"
                    icsw-permission-tree="struct.perm_tree"
                    icsw-user-group-tree="struct.user_group_tree"
                    icsw-user-group-settings-tree="struct.ugs_tree"
                    icsw-device-tree="struct.device_tree"
                ></icsw-user-edit>
            </uib-tab>
        </uib-tabset>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.vdu.overview">
    <!-- vnc viewer mode -->
    <div ng-if="show_single_vdus && ips_loaded">
        <vnc host="{{ ips_for_devices[single_vdus.device] }}" port="{{ single_vdus.websockify_effective_port  }}" is-connected="show_single_vdus" password="{{ single_vdus.password }}" ></vnc>
    </div>
    <!-- dashboard mode -->
    <div ng-if="virtual_desktop_sessions.length == 0">
        No virtual desktop sessions
    </div>
    <div ng-if="(!show_single_vdus) && ips_loaded">
        <div class="panel panel-success" ng-repeat="vdus in virtual_desktop_sessions">
            <div class="panel-heading">
                <h4 class="ng-binding panel-title">
                    {{ get_virtual_desktop_protocol(vdus.virtual_desktop_protocol).description }} session on {{ get_device_by_index(vdus.device).name }} ({{ips_for_devices[vdus.device]}}:{{vdus.effective_port }}) running {{ get_window_manager(vdus.window_manager).description }}
                </h4>
            </div>
            <div class="panel-body">

                <table class="table">
                    <tr>
                        <td>Status</td>
                        <td ng-class="(vdus.state == 1) && 'text-danger'">{{ vdus.state_description }}</td>
                    </tr>
                    <tr>
                        <td>Server</td>
                        <td>{{ips_for_devices[vdus.device]}}:{{ vdus.effective_port }}</td>
                    </tr>
                    <tr>
                        <td>Password</td>
                        <td>{{ vdus.password }}</td>
                    </tr>
                    <tr>
                        <td>Command line</td>
                        <td>{{ vdus.viewer_cmd_line }}</td>
                    </tr>

                    <tr ng-if="vdus.state != 1">
                        <td colspan="2">
                            <button type="button" ng-click="open_vdus_in_new_tab(vdus)" class="btn btn-default">Open in new tab</button>
                            <button type="button" ng-click="download_vdus_start_script(vdus)" class="btn btn-default">Download .vnc configuration file</button>
                        </td>
                    </tr>
                </table>
                <table>
                    <!--
                        <tr>
                            <td>
                                <button type="button" ng-click="show_viewer_command_line(vdus)" class="btn btn-default" data-toggle="button">Show viewer command line</button>
                                <div class="well well-sm" ng-if="vdus.show_viewer_command_line">
                                    {{vdus.viewer_cmd_line}}
                                </div>
                            </td>
                        </tr>
                    -->
                    <tr ng-if="vdus.state != 1">
                        <td>
                        </td>
                        <td colspan="2">

                            <uib-accordion close-others="false">
                               <uib-accordion-group is-open="web_viewer">
                                   <uib-accordion-heading>
                                       Web viewer
                                       <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': web_viewer, 'glyphicon-chevron-right': !web_viewer}"></i>
                                   </uib-accordion-heading>
                                   <div ng-if="web_viewer">
                                       <!--
                                       ie10 warns about leaving the page if a vnc directive is in the dom, this way it is only the case if the user has explicitly opened it
                                       -->
                                       <vnc host="{{ ips_for_devices[vdus.device] }}" port="{{ vdus.websockify_effective_port  }}" is-connected="true" password="{{ vdus.password }}" display="{width:1024,height:768,fitTo:'width',}"></vnc>
                                   </div>
                               </uib-accordion-group>
                           </uib-accordion>
                        </td>
                    </tr>
                </table>

            </div>
       </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.vdu.settings">
    <fieldset>
        <legend>Virtual Desktops</legend>
        <div ng-show="!virtual_desktop_device_available">
            <p>No device supporting a virtual desktop protocol and a window manager found</p>
        </div>
        <div class="form-group" ng_show="virtual_desktop_device_available">
            <label class="control-label col-sm-2">
               Device
            </label>
            <div class="controls col-sm-8">
                <div class='input-group' style='max-width:400px; min-width:240px;'>
                    <ui-select ng-model='_edit_obj.device' ng-change="on_device_change()">
                        <ui-select-match class="ui-select-match" placeholder='Select a device'>{{ $select.selected.name }}</ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat='value.idx as value in virtual_desktop_devices' group-by='&#39;model_name&#39;'>
                            <div ng-bind-html='value.name | highlight: $select.search'></div>
                        </ui-select-choices>
                    </ui-select>
                    <span class='input-group-btn'>
                        <button type="button" ng-click="_edit_obj.device = undefined" class="btn btn-default">
                            <span class="glyphicon glyphicon-trash"/>
                        </button>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Virtual desktop protocol
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.virtual_desktop_protocol' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='Select an virtual desktop protocol'>{{ $select.selected.description }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value.idx as value in get_available_virtual_desktop_protocols(_edit_obj.device)' group-by='model_name'>
                        <div ng-bind-html='value.description | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Port
             </label>
            <div class="controls col-sm-8">
                <input class="numberinput form-control" max="65535" min="0" name="port" ng-model="_edit_obj.port" placeholder="0" type="number"/>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Web VNC Port
            </label>
            <div class="controls col-sm-8">
                <input class="numberinput form-control" max="65535" min="0" name="port" ng-model="_edit_obj.websockify_port" placeholder="0" type="number" />
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device">
            <label class="control-label col-sm-2">
                Window manager
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.window_manager' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='Select a wm'>{{ $select.selected.description }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value.idx as value in get_available_window_managers(_edit_obj.device)' group-by='model_name'>
                        <div ng-bind-html='value.description | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group " ng_show="_edit_obj.device" >
            <label class="control-label col-sm-2">
                Screen size
            </label>
            <div class="controls col-sm-8">
                <ui-select ng-model='_edit_obj.screen_size' style='max-width:400px; min-width:240px;'>
                    <ui-select-match class="ui-select-match" placeholder='...'>{{ $select.selected.name }}</ui-select-match>
                    <ui-select-choices class="ui-select-choices" repeat='value as value in available_screen_sizes'>
                        <div ng-bind-html='value.name | highlight: $select.search'></div>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div>
            <div class="controls form-inline" ng_show="_edit_obj.device && _edit_obj.screen_size.manual">
                <input class="numberinput form-control" type="number" min="200", max="6000" ng-model="_edit_obj.manual_screen_size_x"/> x
                <input class="numberinput form-control" type="number" min="200", max="6000" ng-model="_edit_obj.manual_screen_size_y"/>
            </div>
        </div>
        <div  ng-show="_edit_obj.device">
            <!--<div  class="control-label col-sm-2" > &nbsp; </div>-->
            <div class="form-group row">
                <div class="control-label col-sm-6">
                    Enabled (Check to make sure the server is always running)
                </div>
                <div class="controls col-sm-2">
                    <icsw-tools-yes-no flag="user.start_automatically"></icsw-tools-yes-no>
                </div>
            </div>
        </div>
        <input type="button" name="" value="{{ get_virtual_desktop_submit_mode() }}" class="btn btn btn-sm btn-success" id="button-id-" ng-click="create_virtual_desktop_user_setting()" ng-show="_edit_obj.device" />
        <input type="button" name="" value="cancel" class="btn btn btn-sm btn-danger" id="button-id-" ng-click="cancel_virtual_desktop_user_setting()" ng-show="_edit_obj.device" />
    </fieldset>

    <table class="table table-condensed table-hover table-striped" style="width:100%;">
        <thead>
            <tr>
                <th>Device</th>
                <th>Protocol</th>
                <th>Port</th>
                <th>Web VNC Port</th>
                <th>Window<br/>manager</th>
                <th>Screen size</th>
                <th>Enabled</th>
                <th>State</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="vdus in user.vdus_list">
                <td> {{ device_tree.all_lut[vdus.device].full_name }} </td>
                <td> {{ settings_tree.virtual_desktop_protocol_lut[vdus.virtual_desktop_protocol].description }} </td>
                <td> {{ vdus.port }} </td>
                <td> {{ vdus.websockify_port }} </td>
                <td> {{ settings_tree.window_manager_lut[vdus.window_manager].description }} </td>
                <td> {{ vdus.screen_size }} </td>
                <td> {{ vdus.is_running | yesno2 }} </td>
                <td> {{ vdus.state_description }} </td>
                <td>
                    <button type="button" popover-placement="top" popover-title="Viewer command line" popover="{{ vdus.viewer_cmd_line }}" class="btn btn-xs btn-info">info</button>
                    <button type="button" class="btn btn-xs btn-success" value="modify" ng-click="modify_virtual_desktop_user_setting(vdus)">modify</button>
                    <button type="button" class="btn btn-xs btn-danger" value="delete" ng-click="delete_virtual_desktop_user_setting(vdus)">delete</button>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.user.job.info">
    <div class="container-fluid">
        <h4 ng-show="!jobinfo_valid">waiting for jobinfo ...</h4>
        <table class="table table-hover table-bordered table-condensed" style="width:100%;" ng-if="jobinfo_valid">
            <thead>
                <tr>
                    <th></th>
                    <th>Number of jobs</th>
                    <th>Job ids</th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td> Jobs waiting </td>
                    <td> {{ jobs_waiting.length }} </td>
                    <td> {{ longListToString(jobs_waiting) }} </td>
                </tr>
                <tr>
                    <td> Jobs running </td>
                    <td> {{ jobs_running.length }} </td>
                    <td> {{ longListToString(jobs_running) }} </td>
                </tr>
                <tr>
                    <td>
                        Jobs finished in
                        <div class="btn-group">
                            <button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-dashboard"></span>
                                {{ last_jobinfo_timedelta.name }} <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat="ts in all_timedeltas" ng-click="set_jobinfo_timedelta(ts)">
                                    <a>{{ ts.name }}</a>
                                </li>
                            </ul>
                         </div>
                    </td>
                    <td>{{ jobs_finished.length }}</td>
                    <td>{{ longListToString(jobs_finished) }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.disk.usage">
    <h4>
        {{ scan_run_info() }}
        <span ng-show="current_scan_run">,</span>
        <input ng-show="current_scan_run" type="button" class="btn btn-xs" ng-class="show_dots && 'btn-success'" value="show dot dirs" ng-click="toggle_dots()"/>
    </h4>
    <div ng-if="current_scan_run">
        <icsw-react-tree icsw-tree-config="du_tree"></icsw-react-tree>
    </div>
</script>

<script type="text/ng-template" id="icsw.user.quota.settings">
    <table class="table table-hover table-bordered table-condensed table-striped" style="width:100%;" ng-show="quota_settings.length">
        <thead>
            <tr>
                <th>Device</th>
                <th>Path</th>
                <th>Size</th>
                <th>Flags</th>
                <th>Bytes Graph</th>
                <th>Bytes used</th>
                <th>Bytes limit</th>
                <th>INode Graph</th>
                <th>INodes used</th>
                <th>INodes limit</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="qs in quota_settings" ng-class="qs.$$line_class">
                <td>{{ qs.$$qcb.device.full_name }}</td>
                <td>{{ qs.$$qcb.mount_path }}</td>
                <td>{{ qs.$$qcb.size | get_size:1:1024 }}</td>
                <td class="center">{{ qs.quota_flags }}</td>
                <td style="width:300px;">
                    <div class="row">
                        <div class="col-xs-2">
                            <span class="label label-primary" ng_click="qs.$$show_abs = !qs.$$show_abs">
                                <span ng-show="qs.$$show_abs">Total:</span>
                                <span ng-show="!qs.$$show_abs">Relative:</span>
                            </span>
                        </div>
                        <div class="col-xs-10">
                            <uib-progress ng-show="qs.$$bytes_quota && qs.$$show_abs">
                                <uib-bar ng-repeat="stack in qs.$$bytes_stacked_abs track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</uib-bar>
                            </uib-progress>
                            <uib-progress ng-show="qs.$$bytes_quota && !qs.$$show_abs">
                                <uib-bar ng-repeat="stack in qs.$$bytes_stacked_rel track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</uib-bar>
                            </uib-progress>
                        </div>
                    </div>
                </td>
                <td class="text-center">{{ qs.bytes_used | get_size:1:1024 }}</td>
                <td class="text-center">{{ qs.$$bytes_limit }}</td>
                <td style="width:120px;">
                    <uib-progress ng-show="qs.$$files_quota">
                        <uib-bar ng-repeat="stack in qs.$$files_stacked track by $index" value="stack.value" title="{{ stack.title }}" type="{{ stack.type }}">{{ stack.out }}</uib-bar>
                    </uib-progress>
                </td>
                <td class="text-center">{{ qs.files_used | get_size:1:1000:'' }}</td>
                <td class="text-center">{{ qs.$$files_limit }}</td>
            </tr>
        </tbody>
    </table>
    <h4 ng-show="!quota_settings.length">no quota info</h4>
</script>

<script type="text/ng-template" id="icsw.user.group.permissions">
    <table class="table table-condensed table-hover table-striped" style="width:100%;">
        <thead>
            <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Code</th>
                <th>Level</th>
                <th>Object</th>
                <th>Application</th>
                <th>Model</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="perm in permission_set">
                <td>global</td>
                <td>{{ get_perm(perm.csw_permission).name }}</td>
                <td>{{ get_perm(perm.csw_permission).codename }}</td>
                <td>{{ perm_tree.ac_level_lut[perm.level].info_string }}</td>
                <td>&nbsp;</td>
                <td>{{ get_perm(perm.csw_permission).content_type.app_label }}</td>
                <td>{{ get_perm(perm.csw_permission).content_type.model }}</td>
                <td>
                    <icsw-tools-button type="delete" size="xs" ng-click="delete_permission(perm)"></icsw-tools-button>
                </td>
            </tr>
            <tr ng-repeat="perm in object_permission_set">
                <td>local</td>
                <td>{{ get_perm(perm.csw_object_permission.csw_permission).name }}</td>
                <td>{{ get_perm(perm.csw_object_permission.csw_permission).codename }}</td>
                <td>{{ perm_tree.ac_level_lut[perm.level].info_string }}</td>
                <td>{{ get_perm_object(perm) }}</td>
                <td>{{ get_perm(perm.csw_object_permission.csw_permission).content_type.app_label }}</td>
                <td>{{ get_perm(perm.csw_object_permission.csw_permission).content_type.model }}</td>
                <td>
                    <icsw-tools-button type="delete" size="xs" ng-click="delete_permission(perm)"></icsw-tools-button>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.user.edit.form">
    <form class="form-horizontal" name="form_data">
        <h2>Details for user '{{ user.login }}', password is
            <span ng-if="password_set()">set</span>
            <span ng-if="!password_set()">not set</span>
        </h2>
        <uib-tabset>
            <uib-tab heading="Base settings">
                <div class="row">
                    <div class="col-md-6">
                        <fieldset>
                            <legend>Base data</legend>
                            <div class="form-group">
                                <label class="control-label col-sm-2 requiredField">
                                    Login<span class="asteriskField">*</span>
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="255" ng-model="object.login" required="True" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2 requiredField">
                                    UID<span class="asteriskField">*</span>
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="numberinput form-control" ng-model="object.uid" required="True" type="number"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    First name
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.first_name" placeholder="first name" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Last name
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.last_name" placeholder="last name" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Shell
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.shell" placeholder="shell to use" type="text" value="/bin/bash"/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="col-md-6">
                        <fieldset>
                            <legend>Additional data</legend>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Title
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.title" placeholder="title" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Email
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.email" placeholder="email address" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Mobile phone number
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.pager" placeholder="mobile number" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Telefon number
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.tel" placeholder="telefon number" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Comment
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.comment" placeholder="comment" type="text"/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <fieldset>
                    <legend>Flags</legend>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group controls row">
                                <div class="col-sm-8 control-label">
                                    Active
                                </div>
                                <div class="controls col-sm-4">
                                    <icsw-tools-yes-no flag="object.active"></icsw-tools-yes-no>
                                </div>
                            </div>
                            <div class="form-group controls row">
                                <div class="control-label col-sm-8">
                                    Is superuser
                                </div>
                                <div class="controls col-sm-4">
                                    <icsw-tools-yes-no flag="object.is_superuser"></icsw-tools-yes-no>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group controls row">
                                <div class="control-label col-sm-8">
                                    Database is authoritative for password
                                </div>
                                <div class="controls col-sm-4">
                                    <icsw-tools-yes-no flag="object.db_is_auth_for_password"></icsw-tools-yes-no>
                                </div>
                            </div>
                            <div class="form-group controls row">
                                <div class="col-sm-8 control-label">
                                    Only for webfrontend (== no system user)
                                </div>
                                <div class="controls col-sm-4">
                                    <icsw-tools-yes-no flag="user.only_webfrontend"></icsw-tools-yes-no>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab heading="Group and home settings">
                <fieldset>
                    <legend>Groups / export entry</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2 requiredField">
                            Group<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select ng-model="object.group" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select primary group">{{ $select.selected.groupname }}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in tree.group_list | props_filter:{groupname:$select.search}">
                                    <div ng-bind-html="value.groupname | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Secondary groups
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select multiple="multiple" ng-model="object.secondary_groups" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select secondary groups">{{ $item.groupname }}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in tree.group_list | props_filter:{groupname:$select.search}">
                                    <div ng-bind-html="value.groupname | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group" ng_show="!user.only_webfrontend">
                        <label class="control-label col-sm-2">
                            Export
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="object.export" style="max-width:400px; min-width:240px;">
                                    <ui-select-match class="ui-select-match" placeholder="Select export entry">{{ $select.selected.info_string }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in settings_tree.home_export_list | props_filter:{info_string:$select.search}">
                                        <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="object.export = undefined" class="btn btn-danger">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-show="!object.only_webfrontend">
                        <label class="control-label col-sm-2">
                            Homedir status
                        </label>
                        <div class="col-sm-8">
                            <input type="button" ng-disabled="!user.home_dir_created" ng-class="get_home_dir_created_class(_edit_obj)" ng-value="get_home_dir_created_value(_edit_obj)" ng-click="clear_home_dir_created(_edit_obj)"/>
                        </div>
                    </div>
                    <div class="form-group" ng-show="!object.only_webfrontend">
                        <label class="control-label col-sm-2">
                            Home
                        </label>
                        <div class="controls col-sm-8">
                            <input class="textinput textInput form-control" maxlength="128" ng-model="object.home" type="text"/>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Aliases</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Aliases
                        </label>
                        <div class="controls col-sm-8">
                            <textarea class="textarea form-control" cols="40" ng-model="object.aliases" rows="3"></textarea>
                        </div>
                    </div>
                </fieldset>
                <fieldset ng-show="user.user_quota_setting_set.length && !object.only_webfrontend">
                    <legend>Quota settings</legend>
                    <div class="form-group">
                        <div class="col-sm-12">
                            <icsw-user-quota-settings
                                icsw-object="user"
                                icsw-object-type="'user'"
                                icsw-user-group-settings-tree="settings_tree">
                            </icsw-user-quota-settings>
                        </div>
                    </div>
                </fieldset>
                <fieldset ng-show="!user.only_webfrontend && user.export">
                    <legend>/home scan settings</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">Scan Home dir</label>
                        <div class="controls col-sm-8">
                            <icsw-tools-yes-no flag="object.scan_user_home"></icsw-tools-yes-no>
                        </div>
                    </div>
                    <div class="form-group" ng_show="object.scan_user_home">
                        <label class="control-label col-sm-2 requiredField">
                            Scan depth<span class="asteriskField">*</span>
                        </label>
                        <div class="controls col-sm-8">
                            <input class="numberinput form-control" max="10" min="1" ng-model="object.scan_depth" required="True" type="number" value="2"/>
                        </div>
                    </div>
                </fieldset>
            </uib-tab>
            <uib-tab heading="Permissions">
                <fieldset>
                    <legend>Permissions</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Allowed device groups
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select multiple="multiple" ng-model="object.allowed_device_groups" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select one or more device groups">{{$item.name}}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in device_tree.enabled_ns_group_list | props_filter:{name:$select.search}">
                                    <div ng-bind-html="value.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Permission
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="new_perm.permission">
                                    <ui-select-match class="ui-select-match" placeholder="Select a permission">{{ $select.selected.info_string }}
                                    </ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in perm_tree.permission_list | props_filter:{info_string:$select.search}" group-by="'model_name'">
                                        <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="new_perm.permission = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng_show="new_perm.permission && perm_tree.permission_lut[new_perm.permission].valid_for_object_level">
                        <label class="control-label col-sm-2">
                            Object
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="new_perm.object">
                                    <ui-select-match class="ui-select-match" placeholder="Select an object">{{ $select.selected.name }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in object_list()| props_filter:{name:$select.search}" group-by="'group'">
                                        <div ng-bind-html="value.name | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="new_perm.object = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Permission level
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select ng-model="new_perm.level" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select a permission mode">{{ $select.selected.info_string }}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.level as value in perm_tree.ac_level_list">
                                    <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <icsw-tools-button type="create" value="create global permission" ng-click="create_permission()" ng-show="new_perm.permission"></icsw-tools-button>
                    &nbsp;
                    <icsw-tools-button type="create" value="create object level permission" ng-click="create_object_permission()" ng-show="new_perm.permission && new_perm.object"></icsw-tools-button>
                    <div class="col-sm-12">
                        <icsw-user-group-permissions></icsw-user-group-permissions>
                    </div>
                </fieldset>
                <div class="form-group" ng-show="has_valid_license('virtual_desktop')">
                    <div class="col-sm-12">
                        <icsw-user-virtual-desktop-settings
                            icsw-user="user"
                            icsw-user-group-tree="tree"
                            icsw-user-group-settings-tree="settings_tree"
                            icsw-device-tree="device_tree"
                        ></icsw-user-virtual-desktop-settings>
                    </div>
                </div>
            </uib-tab>
        </uib-tabset>
        <div class="form-actions">
            <icsw-tools-button type="modify" ng-show="!create_mode && changed() && modify_ok" ng-click="modify()"></icsw-tools-button>
            <icsw-tools-button type="create" ng-show="create_mode && modify_ok" ng-click="modify()"></icsw-tools-button>
            &nbsp;
            <icsw-tools-button type="close" ng-click="close()"></icsw-tools-button>
            &nbsp;
            <icsw-tools-button type="delete" ng-click="delete()"></icsw-tools-button>
            &nbsp;
            <icsw-tools-button type="modify" value="change password" ng-click="change_password()"></icsw-tools-button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="icsw.group.edit.form">
    <form class="form-horizontal" name="form_data">
        <h2>Details for group '{{ group.groupname }}'</h2>
        <uib-tabset>
            <uib-tab heading="Base settings">
                <div class="row">
                    <div class="col-md-6">
                        <fieldset>
                            <legend>Basic data</legend>
                            <div class="form-group">
                                <label class="control-label col-sm-2 requiredField">
                                    Groupname<span class="asteriskField">*</span>
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="48" ng-model="object.groupname" ng-pattern="/^.+$/" required="True" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2 requiredField">
                                    Gid<span class="asteriskField">*</span>
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="numberinput form-control" ng-model="object.gid" ng-pattern="/^\d+$/" required="True" type="number"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2 requiredField">
                                    Homestart<span class="asteriskField">*</span>
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" ng-model="object.homestart" ng-pattern="/^\/.*/" required="True" type="text"/>
                                </div>
                            </div>
                            <div class="form-actions">
                                <div class="form-group">
                                    <label>
                                        Active
                                    </label>
                                    <icsw-tools-yes-no flag="object.active"></icsw-tools-yes-no>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="col-md-6">
                        <fieldset>
                            <legend>Additional data</legend>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Email
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.email" placeholder="email address" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Mobile
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.pager" placeholder="mobile number" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Tel
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.tel" placeholder="telefon number" type="text"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">
                                    Comment
                                </label>
                                <div class="controls col-sm-8">
                                    <input class="textinput textInput form-control" maxlength="765" ng-model="object.comment" placeholder="comment" type="text"/>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </uib-tab>
            <uib-tab heading="Permissions">
                <fieldset>
                    <legend>Permissions</legend>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Parent group
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="_edit_obj.parent_group">
                                    <ui-select-match class="ui-select-match" placeholder="Select a parent group">{{ $select.selected.groupname }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in parent_groups[_edit_obj.idx]| props_filter:{groupname:$select.search}">
                                        <div ng-bind-html="value.groupname | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="object.parent_group = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Allowed device groups
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select multiple="multiple" ng-model="object.allowed_device_groups" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select one or more device groups">{{ $item.name }}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.idx as value in device_tree.enabled_ns_group_list | props_filter:{name:$select.search}">
                                    <div ng-bind-html="value.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Permission
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="new_perm.permission">
                                    <ui-select-match class="ui-select-match" placeholder="Select a permission">{{ $select.selected.info_string }}
                                    </ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in perm_tree.permission_list | props_filter:{info_string:$select.search}" group-by="'model_name'">
                                        <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="new_perm.permission = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng_show="new_perm.permission && perm_tree.permission_lut[new_perm.permission].valid_for_object_level">
                        <label class="control-label col-sm-2">
                            Object
                        </label>
                        <div class="controls col-sm-8">
                            <div class="input-group" style="max-width:400px; min-width:240px;">
                                <ui-select ng-model="new_perm.object">
                                    <ui-select-match class="ui-select-match" placeholder="Select an object">{{ $select.selected.name }}</ui-select-match>
                                    <ui-select-choices class="ui-select-choices" repeat="value.idx as value in object_list()| props_filter:{name:$select.search}" group-by="'group'">
                                        <div ng-bind-html="value.name | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                                <span class="input-group-btn">
                                    <button type="button" ng-click="new_perm.object = undefined" class="btn btn-default">
                                        <span class="glyphicon glyphicon-trash"/>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2">
                            Permission level
                        </label>
                        <div class="controls col-sm-8">
                            <ui-select ng-model="new_perm.level" style="max-width:400px; min-width:240px;">
                                <ui-select-match class="ui-select-match" placeholder="Select a permission mode">{{ $select.selected.info_string }}</ui-select-match>
                                <ui-select-choices class="ui-select-choices" repeat="value.level as value in perm_tree.ac_level_list">
                                    <div ng-bind-html="value.info_string | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <icsw-tools-button type="create" value="create global permission" ng-click="create_permission()" ng-show="new_perm.permission"></icsw-tools-button>
                    &nbsp;
                    <icsw-tools-button type="create" value="create object level permission" ng-click="create_object_permission()" ng-show="new_perm.permission && new_perm.object"></icsw-tools-button>
                    <div class="col-sm-12">
                        <icsw-user-group-permissions></icsw-user-group-permissions>
                    </div>
                </fieldset>
            </uib-tab>
        </uib-tabset>
        <div class="form-actions">
            <icsw-tools-button type="modify" ng-show="!create_mode && changed()" ng-click="modify()"></icsw-tools-button>
            <icsw-tools-button type="create" ng-show="create_mode" ng-click="modify()"></icsw-tools-button>
            &nbsp;
            <icsw-tools-button type="close" ng-click="close()"></icsw-tools-button>
            &nbsp;
            <icsw-tools-button type="delete" ng-click="delete()"></icsw-tools-button>
        </div>
    </form>
</script>

<script type="text/ng-template" id="icsw.account.detail.form">
    <div class="container-fluid">
        <form class="form-horizontal" ng-submit="update_account()">
            <h2>Account info for '{{ struct.user.login }}'</h2>
            <div class="row">
                <div class="col-md-6">
                    <fieldset class="form-horizontal">
                        <legend>Base data</legend>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                First name
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.first_name" placeholder="first name" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Last name
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.last_name" placeholder="last name" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Shell
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.shell" placeholder="shell to use" type="text" value="/bin/bash"/>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="col-md-6">
                    <fieldset class="form-horizontal">
                        <legend>Additional data</legend>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Title
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.title" placeholder="Title" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Email
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.email" placeholder="EMail address" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Mobile
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.pager" placeholder="pager number" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Tel
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.tel" placeholder="Telefon number" type="text"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">
                                Comment
                            </label>
                            <div class="controls col-sm-8">
                                <input class="textinput textInput form-control" maxlength="765" ng-model="struct.user.comment" placeholder="User comment" type="text"/>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="form-actions">
                <icsw-tools-button type="submit" ng-click="update_account()"></icsw-tools-button>
                &nbsp;
                <icsw-tools-button type="modify" value="change password" ng-click="change_password()"></icsw-tools-button>
            </div>
        </form>
    </div>
</script>
