<script type="text/ng-template" id="icsw.device.variable.head">
    <tr>
        <th>Info</th>
        <th>Name</th>
        <th>Group</th>
        <th>Comment</th>
        <th colspan="1">Action</th>
    </tr>
    <tr>
        <td colspan="99">
            <div
                icsw-tools-pagination
                st-displayed-pages="11"
                st-items-by-page="15"
                possible-items-by-page="15,30,100,200"
            ></div>
        </td>
    </tr>
</script>

<script type="text/ng-template" id="icsw.device.variable.row">
    <td>
        <button class="btn btn-primary btn-xs" ng-disabled="!obj.device_variables_filtered.length" ng-click="config_service.toggle_expand(obj)">
            <span ng_class="config_service.get_expand_class(obj)"></span>
            {{ obj.$num_vars_total }}
            <span ng-if="obj.$var_filter_active"> / {{ obj.$num_vars_filtered }} shown</span>
            <span ng-if="obj.$num_vars_parent">&nbsp;({{ obj.$num_vars_parent }} inherited)</span>
            <span ng-if="obj.$num_vars_shadowed">&nbsp;({{ obj.$num_vars_shadowed }} shadowed)</span>
        </button>
    </td>
    <td>{{ get_name(obj) }}</td>
    <td>{{ obj.device_group_name }}</td>
    <td>{{ obj.comment }}</td>
    <td>
        <icsw-tools-button value="create" type="create" ng-click="create($event, obj)" size="xs"/>
    </td>
</script>

<script type="text/ng-template" id="icsw.device.variable.table">
    <table ng-show="device.$vars_expanded || device.num_filtered" class="table table-condensed table-hover" style="width:auto;">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Value</th>
                <th>Public</th>
                <th>Inherit</th>
                <th>source</th>
                <th colspan="1">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="obj in device.device_variables_filtered">
                <td>{{ obj.name }}</td>
                <td class="text-center"><span class="badge">{{ obj.$var_type }}</span></td>
                <td>{{ obj.$var_value }}</td>
                <td>{{ obj.is_public|yesno1 }}</td>
                <td>{{ obj.inherit | yesno2 }}</td>
                <td>
                    {{ config_service.get_source(obj, device) }}
                </td>
                <td>
                    <icsw-tools-button type="modify" size="xs" ng-show="config_service.variable_edit_ok(obj, device)" ng-click="edit($event, obj)"/>
                    <icsw-tools-button type="delete" size="xs" ng-show="config_service.variable_delete_ok(obj, device)" ng-click="delete($event, obj)"/>
                    <icsw-tools-button type="create" size="xs" ng-show="config_service.variable_local_copy_ok(obj, device)" ng-click="special_fn($event, 'local_copy', obj, device)" value="local copy"/>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/ng-template" id="icsw.device.variable.overview">
    <icsw-tools-ensure-device-selection dev-list="struct.devices" list-ready="dataLoaded">
        <h2>
            Device variables ({{ struct.devices.length }} devices)
        </h2>
        <div class="row">
            <div class="col-sm-5 form-inline">
                <div class="form-group">
                    NameFilter: <input class="form-control" ng-model="vars.name_filter" ng-change="new_filter_set()" placeholder="filter"/>
                </div>
            </div>
        </div>

        <icsw-tools-rest-table-new target-list="var_devices" icsw-config-object="struct" config-service="icswDeviceVariableListService">
            <h4 ng-if="struct.devices.length > 1">
                <icsw-tools-button type="create" value="create for all" title="create a new variable for all shown devices" ng-click="special_fn($event, 'create_for_all')" size="xs"></icsw-tools-button>
            </h4>
            <table st-table="var_devices_displayed" st-safe-src="var_devices" class="table table-condensed table-hover" style="width:auto;">
                <thead icsw-device-variable-head></thead>
                <tbody>
                    <tr icsw-device-variable-row ng-repeat-start="obj in var_devices_displayed" ng-class="get_tr_class(obj)">
                    </tr>
                    <tr ng-repeat-end ng-if="obj.$vars_expanded">
                        <td colspan="9">
                            <icsw-device-variable-table device="obj"></icsw-device-variable-table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </icsw-tools-rest-table-new>
    </icsw-tools-ensure-device-selection>
</script>

<script type="text/ng-template" id="icsw.device.variable.form">
    <form class="form-horizontal" name="form_data">
        <h2>Device variable '{{ edit_obj.name }}'</h2>
        <fieldset ng-show="edit_obj.device && mon_vars.length && single_create">
            <legend>Monitoring variables</legend>
            <div class="form-group">
                <label class="control-label col-sm-3">Copy</label>
                <div class="controls col-sm-8">
                    <div class='input-group' style='max-width:400px; min-width:240px;'>
                        <ui-select ng-model="edit_obj._mon_var" ng-change="take_mon_var()">
                            <ui-select-match class="ui-select-match" placeholder="select a monitoring variable">
                                {{ $select.selected.info }}
                            </ui-select-match>
                            <ui-select-choices class="ui-select-choices" repeat="entry as entry in mon_vars | props_filter:{info:$select.search}">
                                <div ng-bind-html="entry.info | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <span class='input-group-btn'>
                            <button type="button" ng-click="edit_obj._mon_var = null" class="btn btn-default">
                                <span class="glyphicon glyphicon-trash"/>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Basic settings</legend>
            <div class="form-group  ng-class:form_error('name')">
                <label class="control-label col-sm-3 requiredField">
                    Name<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <input class="textinput textInput form-control" name="name" maxlength="765" ng-model="edit_obj.name" required="True" type="text"/>
                </div>
            </div>
            <div class="form-group" ng-if="create">
                <label class="control-label col-sm-3 requiredField">
                    Type<span class="asteriskField">*</span>
                </label>
                <div class="controls col-sm-8">
                    <ui-select ng-model="edit_obj.var_type" style="max-width:400px; min-width:240px;" ng-disabled="false">
                        <ui-select-match class="ui-select-match" placeholder="Variable type">
                            {{ $select.selected.long }}
                        </ui-select-match>
                        <ui-select-choices class="ui-select-choices" repeat="value.short as value in valid_var_types| props_filter:{long:$select.search}">
                            <div ng-bind-html="value.long | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group" ng_show="edit_obj.var_type == 's'">
                <label class="control-label col-sm-3">
                    Value (string)
                </label>
                <div class="controls col-sm-8">
                    <textarea class="textarea form-control" cols="40" ng-model="edit_obj.val_str" rows="10">
                    </textarea>
                </div>
            </div>
            <div class="form-group" ng_show="edit_obj.var_type == 'i'">
                <label class="control-label col-sm-3">
                    Value (integer)
                </label>
                <div class="controls col-sm-8">
                    <input class="numberinput form-control" ng-model="edit_obj.val_int" type="number" value="0"/>
                </div>
            </div>
            <div class="form-group" ng_show="edit_obj.var_type == 'd'">
                <label class="control-label col-sm-3">
                    Value (date)
                </label>
                <div class="controls col-sm-8">
                    <input class="datetimeinput form-control" ng-model="edit_obj.val_date" type="text"/>
                </div>
            </div>
            <div class="form-group" ng_show="edit_obj.var_type == 't'">
                <label class="control-label col-sm-3">
                    Value (time)
                </label>
                <div class="controls col-sm-8">
                    <textarea class="textarea form-control" cols="40" ng-model="edit_obj.val_time" rows="10">
                    </textarea>
                </div>
            </div>
            <div class="form-group" ng_show="edit_obj.var_type == 'b'">
                <label class="control-label col-sm-3">
                    Value (blob)
                </label>
                <div class="controls col-sm-8">
                    <textarea class="textarea form-control" cols="40" ng-model="edit_obj.val_blob" rows="10">
                    </textarea>
                </div>
            </div>
        </fieldset>
        <fieldset ng-show="!edit_obj._mon_var">
            <legend>Flags</legend>
            <div class="form-group">
                <label class="control-label col-sm-3">
                    Inherit
                </label>
                <div class="controls col-sm-8">
                    <icsw-tools-yes-no flag="edit_obj.inherit"/>
                </div>
            </div>
        </fieldset>
    </form>
</script>

<script type="text/ng-template" id="icsw.device.configuration.var.overview">
    <h2>
        Config variables for {{ devsel_list.length }} devices, <input type="button" class="btn btn-xs btn-primary" value="show vars" ng-click="load_vars()"/>
    </h2>
    <div class="row">
        <div class="col-sm-5 form-inline" ng-show="loaded">
            <div class="form-group">
                <input class="form-control" ng-model="var_filter" placeholder="filter"/>
            </div>
        </div>
    </div>
    <div ng-show="loaded">
        <tree treeconfig="devvar_tree"></tree>
    </div>
</script>
