<script type="text/ng-template" id="icsw/main/serverinfo.html">
    <icsw-layout-server-info-overview></icsw-layout-server-info-overview>
</script>

<script type="text/ng-template" id="icsw.layout.server.info.overview">
    <uib-accordion close-others="no">
        <uib-accordion-group is-open="struct.is_open_roles">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': struct.is_open_roles, 'glyphicon-chevron-right': !struct.is_open_roles}"></i>
                {{ num_roles() }} valid cluster roles defined (viewed from {{ struct.local_device }})
                <span class="text-warning" ng-show="struct.loading">Updating ...</span>
                <span class="label label-danger" ng-show="struct.unroutable_config_names.length">There are {{ struct.unroutable_config_names.length }} unroutable configs</span>
            </uib-accordion-heading>
            <uib-alert type="warning" ng-show="struct.unroutable_config_names.length">
                <h2>Unroutable Configs</h2>
                <table class="table table-hover table-striped" style="width:auto;">
                    <thead>
                        <tr>
                            <th>Config</th>
                            <th># devs</th>
                            <th>devices</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="conf in struct.unroutable_config_names">
                            <td class="text-danger">{{ conf }}</td>
                            <td class="text-danger">{{ struct.unroutable_configs[conf].length }}</td>
                            <td>{{ struct.unroutable_configs[conf].join(", ") }}</td>
                        </tr>
                    </tbody>
                </table>
            </uib-alert>
            <table class="table table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th># configs</th>
                        <th>Config names</th>
                        <th>reachable IP</th>
                        <th>cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat-start="role in get_roles()">
                        <th colspan="5">{{ role }}, {{ get_num_servers(role) }} devices</th>
                    </tr>
                    <tr ng-repeat-end ng-repeat="server in get_servers(role)">
                        <td>{{ server[0] }}</td>
                        <td>{{ server[4].length }}</td>
                        <td>{{ get_config_names(server) }}</td>
                        <td>{{ server[1] }}</td>
                        <td>{{ server[3] }}</td>
                    </tr>
                </tbody>
            </table>
        </uib-accordion-group>
        <uib-accordion-group is-open="struct.is_open_list">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': struct.is_open_list, 'glyphicon-chevron-right': !struct.is_open_list}"></i>
                <ng-pluralize count="struct.server_info_list.length" when="{'0': 'No Server results', 'one': 'One Server result', 'other': '{} Server results'}"></ng-pluralize>
                <span class="text-warning" ng-show="struct.loading">Updating ...</span>
            </uib-accordion-heading>
            <table class="table table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>valid</th>
                        <th>Name</th>
                        <th>Result</th>
                        <th>ModelsVers</th>
                        <th>DatabaseVers</th>
                        <th>SoftwareVers</th>
                        <th>max Memory</th>
                        <th>total Memory</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="srv_info in struct.server_info_list" ng-class="srv_info.get_tr_class()">
                        <td>{{ srv_info.valid | yesno2 }}</td>
                        <td>{{ srv_info.get_name() }}</td>
                        <td>{{ srv_info.server_reply }}</td>
                        <td class="text-center">
                            <span ng-show="srv_info.version_set">{{ srv_info.version_models }}</span>
                            <span ng-show="!srv_info.version_set">---</span>
                        </td>
                        <td class="text-center">
                            <span ng-show="srv_info.version_set">{{ srv_info.version_database }}</span>
                            <span ng-show="!srv_info.version_set">---</span>
                        </td>
                        <td class="text-center">
                            <span ng-show="srv_info.version_set">{{ srv_info.version_software }}</span>
                            <span ng-show="!srv_info.version_set">---</span>
                        </td>
                        <td class="text-right">{{ srv_info.max_mem | get_size:1:1024:"B":3 }}</td>
                        <td class="text-right">{{ srv_info.sum_mem | get_size:1:1024:"B":3 }}</td>
                    </tr>
                </tbody>
            </table>
        </uib-accordion-group>
        <uib-accordion-group is-open="struct.is_open_detail">
            <uib-accordion-heading>
                <i class="glyphicon" ng-class="{'glyphicon-chevron-down': struct.is_open_detail, 'glyphicon-chevron-right': !struct.is_open_detail}"></i>
                <ng-pluralize count="struct.server_info_list.length" when="{'0': 'No Servers checked', 'one': 'One Server checked', 'other': '{} Servers checked'}"></ng-pluralize>
                <span class="text-warning" ng-show="struct.loading">Updating ...</span>
            </uib-accordion-heading>
            <table class="table table-hover table-striped" style="width:auto;">
                <thead>
                    <tr>
                        <th>Instance</th>
                        <th>Type</th>
                        <th>Check</th>
                        <th ng-repeat="srv_info in server_info_list">
                            {{ srv_info.get_name() }},
                            {{ srv_info.max_mem | get_size:1:1024:"B":3 }} max /
                            {{ srv_info.sum_mem | get_size:1:1024:"B":3 }} total Memory
                         </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="instance in struct.instance_list">
                        <td>{{ instance }}</td>
                        <td>{{ get_runs_on(instance) }}</td>
                        <td>{{ server_info_list[0].get_check_source(instance) }}</td>
                        <td ng-repeat="srv_info in struct.server_info_list">
                            <icsw-layout-server-info-instance></icsw-layout-server-info-instance>
                        </td>
                    </tr>
                </tbody>
            </table>
        </uib-accordion-group>
    </uib-accordion>
</script>

<script type="text/ng-template" id="icsw.service.enable.disable">
    <div class="col-xs-2" ng-show="acl_modify(null, 'backbone.user.server_control') &&  has_startstop() && enable_disable_allowed()">
        <icsw-tools-button type="disable" size="xs" ng-click="action('disable')" ng-show="service_enabled()"></icsw-tools-button>
        <icsw-tools-button type="enable" size="xs" ng-click="action('enable')" ng-show="service_disabled()"></icsw-tools-button>
    </div>
</script>

<script type="text/ng-template" id="icsw.layout.server.info.state">
    <div ng-switch on="get_state()">
        <div class="text-warning" ng-switch-when="0">
            <!-- no info found -->
            ---
        </div>
        <div class="row" style="width:520px;" ng-switch-when="1">
            <div class="col-xs-3 text-right">
                <span ng-class="get_version_class()" ng-bind-html="get_version()"></span>
            </div>
            <div class="col-xs-2 text-center" style="white-space:nowrap;">
                <span ng-class="get_run_class()">{{ get_run_info() }}</span>
            </div>
            <div class="col-xs-2 text-right">{{ get_mem_info() | get_size:1:1024 }}</div>
            <div class="col-xs-3" style="height:10px;">
                <uib-progressbar ng-show="get_mem_value()" value="get_mem_value()" animate="false"></uib-progressbar>
            </div>
            <icsw-service-enable-disable></icsw-service-enable-disable>
        </div>
        <div class="row" ng-switch-when="2">
            <div class="col-xs-3 text-right">
                <span ng-class="get_version_class()" ng-bind-html="get_version()"></span>
            </div>
            <div class="col-xs-7 text-danger">
                not running
            </div>
            <icsw-service-enable-disable></icsw-service-enable-disable>
        </div>
        <div class="row" ng-switch-when="4">
            <div class="col-xs-3 text-right">
                <span ng-class="get_version_class()" ng-bind-html="get_version()"></span>
            </div>
            <div class="col-xs-7 text-danger">
                not configured
            </div>
            <icsw-service-enable-disable></icsw-service-enable-disable>
        </div>
        <div class="row" ng-switch-when="3">
            <div class="col-xs-12 text-warning">
                not installed
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="icsw.internal.state.list">
    <h3>Internal State List ({{ struct.state_list.length }})</h3>
    <table
        st-table="entries_displayed"
        st-safe-src="struct.state_list"
        class="table table-condensed table-hover table-striped"
        style="width:auto;"
    >
        <thead>
            <tr>
                <td colspan="99">
                    <div icsw-tools-pagination st-items-by-page="20" st-displayed-pages="11"
                         possible-items-by-page="20,50,100,200,500,1000"></div>
                </td>
            </tr>
            <tr>
                <th st-sort="name" st-sort-default="true">Name</th>
                <th>Allowed</th>
                <th>Header</th>
                <th>Entry</th>
                <th>Quicklink</th>
                <th>Dashboard</th>
                <th>PageTitle</th>
                <th>MenuHeaderInfo</th>
                <th>MenuEntryInfo</th>
                <th>DashboardInfo</th>
                <th>Rights</th>
                <th>Licenses</th>
                <th>Service types</th>
                <th colspan="1" class="text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="obj in entries_displayed">
                <td>{{ obj.name }}</td>
                <td class="text-center">{{ obj.icswData.$$allowed | yesno1 }}</td>
                <td class="text-center">{{ obj.icswData.$$menuHeader | yesno1 }}</td>
                <td class="text-center">{{ obj.icswData.$$menuEntry | yesno1 }}</td>
                <td class="text-center">{{ obj.icswData.valid_for_quicklink | yesno1 }}</td>
                <td class="text-center">{{ obj.icswData.$$dashboardEntry | yesno1 }}</td>
                <td>{{ obj.icswData.pageTitle }}</td>
                <td>
                    <span ng-show="obj.icswData.$$menuHeader">
                        {{ obj.icswData.menuHeader.key }} <span ng-class="get_header_class(obj)"></span> ({{ obj.icswData.menuHeader.ordering }})
                    </span>
                </td>
                <td>
                    <span ng-show="obj.icswData.$$menuEntry">
                        [{{ obj.icswData.menuEntry.menukey }}] {{ obj.icswData.menuEntry.name }} <span ng-class="get_entry_class(obj)"></span> ({{ obj.icswData.menuEntry.ordering }})
                    </span>
                </td>
                <td>
                    <span ng-show="obj.icswData.$$dashboardEntry">
                        ({{ obj.icswData.dashboardEntry.size_x }} x {{ obj.icswData.dashboardEntry.size_y }})
                        <span ng-show="obj.icswData.dashboardEntry.default_enabled">
                            , default
                        </span>
                        <span ng-show="obj.icswData.dashboardEntry.allow_state">
                            , state
                        </span>
                        <span ng-show="obj.icswData.dashboardEntry.allow_show">
                            , popup
                        </span>
                    </span>
                </td>
                <td class="text-center">
                    {{ obj.icswData.$$rights_info }}
                </td>
                <td class="text-center">
                    {{ obj.icswData.$$licenses_info }}
                </td>
                <td class="text-center">
                    {{ obj.icswData.$$service_types_info }}
                </td>
                <td class="text-center">
                    <icsw-tools-button type="create" value="go" size="xs" ng-click="go($event, obj)"></icsw-tools-button>
                </td>
            </tr>
        </tbody>
    </table>
</script>
